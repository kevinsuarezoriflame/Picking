
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Solicitud de productos PL </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
        body {
            background-color: #ecfbf6;
        }
        .table th, .table td {
            vertical-align: middle;
            text-align: center;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<div class="container py-4">
<h2 class="text-center mb-4"> Solicitud de productos PL</h2>
<div class="row mb-3">
<div class="col-md-3">
<input class="form-control" id="responsable" placeholder="Responsable" type="text"/>
</div>
<div class="col-md-3">
<input class="form-control" id="codigo" placeholder="C贸digo" type="number"/>
</div>
<div class="col-md-3">
<input class="form-control" id="cantidad" placeholder="Cantidad" type="number"/>
</div>
<div class="col-md-3">
<button class="btn btn-success w-100" onclick="agregarFila()">Agregar</button>
</div>
</div>
<div class="mb-3" id="uploadBox">
<input accept=".xlsx" class="form-control mb-2" id="excelFile" type="file"/>
</div>
<table class="table table-bordered table-striped" id="tabla">
<thead class="table-light" style="background-color:#d4ede4;">
<tr>
<th>Responsable</th>
<th>C贸digo</th>
<th>Cantidad</th>
<th>Ubicaci贸n</th>
<th>Hora</th>
<th>Acci贸n</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
        let stock = [];

        document.getElementById("excelFile").addEventListener("change", function (e) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: "array" });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                stock = XLSX.utils.sheet_to_json(worksheet, { defval: "" });
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        });

        document.addEventListener("keypress", function (e) {
            if (e.key === "Enter") agregarFila();
        });

        function buscarUbicacion(codigo) {
            const found = stock.find(item => item.Variante == codigo);
            return found ? found.Caja : "No encontrada";
        }

        function agregarFila() {
            const responsable = document.getElementById("responsable").value.trim();
            const codigo = document.getElementById("codigo").value.trim();
            const cantidad = document.getElementById("cantidad").value.trim();

            if (!responsable || !codigo || !cantidad) return;

            const ubicacion = buscarUbicacion(codigo);
            const hora = new Date().toLocaleTimeString();

            const tabla = document.getElementById("tabla").querySelector("tbody");
            const fila = tabla.insertRow();

            fila.innerHTML = `
                <td>${responsable}</td>
                <td>${codigo}</td>
                <td>${cantidad}</td>
                <td>${ubicacion}</td>
                <td>${hora}</td>
                <td><button class="btn btn-danger btn-sm" onclick="eliminarFila(this)">Eliminar</button></td>
            `;

            document.getElementById("codigo").value = "";
            document.getElementById("cantidad").value = "";
            document.getElementById("codigo").focus();
        }

        function eliminarFila(btn) {
            btn.closest("tr").remove();
        }
    </script>
<script>
document.querySelector('input[type="file"]').addEventListener("change", function() {
    this.style.display = "none";
});
</script></body>
</html>
